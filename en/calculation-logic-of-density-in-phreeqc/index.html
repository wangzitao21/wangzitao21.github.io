<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Calculation Logic of Density in PHREEQC | Wang's Blog</title><meta name=keywords content="PHREEQC"><meta name=description content="The way PHREEQC calculates density has always puzzled me. Sometimes, I input a density value A, but the output density is B. Then, when I change the input density to B, the output density becomes C.
After repeatedly consulting the PHREEQC Users forum, I have basically figured out the calculation logic of density. Here is my summary.
Background
In PHREEQC, there are two units for measuring the mass of a liquid: kgw and kgs."><meta name=author content="Zitao Wang"><link rel=canonical href=https://wangzitao21.github.io/en/calculation-logic-of-density-in-phreeqc/><script type=text/javascript async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"}),MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}})</script><link crossorigin=anonymous href=/assets/css/stylesheet.fd8148162c37b6c614040ca84c7e23ff1f4345bbfc886131f171350edd32073f.css integrity="sha256-/YFIFiw3tsYUBAyoTH4j/x9DRbv8iGEx8XE1Dt0yBz8=" rel="preload stylesheet" as=style><link rel=icon href=https://wangzitao21.github.io/favicon/favicon16x16.gif><link rel=icon type=image/png sizes=16x16 href=https://wangzitao21.github.io/favicon/favicon16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangzitao21.github.io/favicon/favicon32x32.png><link rel=apple-touch-icon href=https://wangzitao21.github.io/favicon/favicon180x180.png><link rel=mask-icon href=https://wangzitao21.github.io/favicon/favicon180x180.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangzitao21.github.io/en/calculation-logic-of-density-in-phreeqc/><link rel=alternate hreflang=zh href=https://wangzitao21.github.io/zh/phreeqc-%E4%B8%AD%E5%AF%86%E5%BA%A6%E7%9A%84%E8%AE%A1%E7%AE%97%E9%80%BB%E8%BE%91/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://wangzitao21.github.io/en/calculation-logic-of-density-in-phreeqc/"><meta property="og:site_name" content="Wang's Blog"><meta property="og:title" content="Calculation Logic of Density in PHREEQC"><meta property="og:description" content="The way PHREEQC calculates density has always puzzled me. Sometimes, I input a density value A, but the output density is B. Then, when I change the input density to B, the output density becomes C.
After repeatedly consulting the PHREEQC Users forum, I have basically figured out the calculation logic of density. Here is my summary.
Background In PHREEQC, there are two units for measuring the mass of a liquid: kgw and kgs."><meta property="og:locale" content="en-US"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-01-22T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-22T00:00:00+00:00"><meta property="article:tag" content="PHREEQC"><meta name=twitter:card content="summary"><meta name=twitter:title content="Calculation Logic of Density in PHREEQC"><meta name=twitter:description content="The way PHREEQC calculates density has always puzzled me. Sometimes, I input a density value A, but the output density is B. Then, when I change the input density to B, the output density becomes C.
After repeatedly consulting the PHREEQC Users forum, I have basically figured out the calculation logic of density. Here is my summary.
Background
In PHREEQC, there are two units for measuring the mass of a liquid: kgw and kgs."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangzitao21.github.io/en/post/"},{"@type":"ListItem","position":2,"name":"Calculation Logic of Density in PHREEQC","item":"https://wangzitao21.github.io/en/calculation-logic-of-density-in-phreeqc/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Calculation Logic of Density in PHREEQC","name":"Calculation Logic of Density in PHREEQC","description":"The way PHREEQC calculates density has always puzzled me. Sometimes, I input a density value A, but the output density is B. Then, when I change the input density to B, the output density becomes C.\nAfter repeatedly consulting the PHREEQC Users forum, I have basically figured out the calculation logic of density. Here is my summary.\nBackground In PHREEQC, there are two units for measuring the mass of a liquid: kgw and kgs.\n","keywords":["PHREEQC"],"articleBody":"The way PHREEQC calculates density has always puzzled me. Sometimes, I input a density value A, but the output density is B. Then, when I change the input density to B, the output density becomes C.\nAfter repeatedly consulting the PHREEQC Users forum, I have basically figured out the calculation logic of density. Here is my summary.\nBackground In PHREEQC, there are two units for measuring the mass of a liquid: kgw and kgs.\nAssuming that the solvent is pure water, then:\nkgw refers to 1 kg of pure water. c($x$)=1 mmol/kgw means that one kilogram of pure water contains 1 mmol of $x$. kgs refers to 1 kg of solution, which includes both solute and pure water. c($x$)=1 mmol/kgs means that one kilogram of solution (mass of pure water + solute) contains 1 mmol of $x$. When the solution is a dilute solution, the mass of the solute can be ignored. In this case, the density, viscosity, and other properties of pure water are the properties of the solution.\nOnly when the solute concentration is very high and has seriously affected the mass of the solution will the mass of the solution be much greater than the mass of pure water, and the density will differ greatly.\nIn PHREEQC, Molality, Activity, and Moles are output. Among them, Molality refers to the number of moles of solute per kilogram of solvent, that is, mol/kgw; Moles refers to the total number of moles of elements in the entire solution, that is, mol; Activity refers to the ion activity, the unit is the same as Molality.\nThree Scenarios of Density Calculation According to the different input units, I divide the calculation logic of PHREEQC into three situations:\n1 Input Unit is mg/kgw or mol/kgw When the input solution unit is mg/kgw or mol/kgw, the input density has no effect on the display of PHREEQC, and the input concentration is equal to the Molality finally calculated by PHREEQC.\nFor example, we input the following solution, using the database pitzer.dat:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 SOLUTION 1 -water 1 -temp 25 -units mol/kgw density 1 pH 7 pe 4.0 Ca 0.7 Na 0.889 Mg 0.2 C(4) 0.2 S(6) 0.256 Cl 0.4 END At this time, we don‚Äôt care about the ion speciation, only look at the concentration results:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 -----------------------------Solution composition------------------------------ Elements Molality Moles C(4) 2.000e-01 2.000e-01 Ca 7.000e-01 7.000e-01 Cl 4.000e-01 4.000e-01 Mg 2.000e-01 2.000e-01 Na 8.890e-01 8.890e-01 S(6) 2.560e-01 2.560e-01 ----------------------------Description of solution---------------------------- pH = 7.000 pe = 4.000 Density (g/cm3) = 1.09475 Volume (L) = 1.00850 Mass of water (kg) = 1.000e+00 Try to modify the input density and you will find that no matter what the input density is, the output solution density and volume will not change. This is because PHREEQC does not use our input density at all. It will automatically calculate the volume and density of the input solution based on the molar concentration and moles of the solute.\nIf the above input unit is changed from mol/kgw to mg/kgw, the output result is:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 -----------------------------Solution composition------------------------------ Elements Molality Moles C(4) 3.278e-06 3.278e-06 Ca 1.747e-05 1.747e-05 Cl 1.128e-05 1.128e-05 Mg 8.229e-06 8.229e-06 Na 3.867e-05 3.867e-05 S(6) 2.665e-06 2.665e-06 ----------------------------Description of solution---------------------------- pH = 7.000 pe = 4.000 Density (g/cm3) = 0.99705 Volume (L) = 1.00297 Mass of water (kg) = 1.000e+00 At this time, the Solution composition part will be automatically converted to mol/kgw by PHREEQC, and the volume and density are also automatically calculated.\nIn summary, if the input unit is mg/kgw or mol/kgw, PHREEQC will calculate the density itself, and no matter what density is input, it will be ignored.\n2 Input Unit is mg/kgs or mol/kgs When our input solution unit is mg/kgs or mol/kgs, the input density has no effect on the display of PHREEQC either, because there is no volume calculation involved. But at this time, the input solute concentration is not equal to the Molality finally calculated by PHREEQC, and conversion is required.\nTaking the following solution as an example, the conversion method of PHREEQC is explained:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 SOLUTION 1 -water 1 -temp 25 -units mol/kgs density 1 pH 7 pe 4.0 Ca 0.7 Na 0.889 Mg 0.2 C(4) 0.2 S(6) 0.256 Cl 0.4 END Run the above script in PHREEQC, and the result is as follows:\n1 2 3 4 5 6 7 Elements Molality Moles C(4) 2.233e-01 2.233e-01 Ca 7.815e-01 7.815e-01 Cl 4.466e-01 4.466e-01 Mg 2.233e-01 2.233e-01 Na 9.926e-01 9.926e-01 S(6) 2.858e-01 2.858e-01 It can be seen that the calculation result of PHREEQC is larger than the input concentration. The calculation logic here should be:\nFirst convert the solute concentration from mol/kgs to kg/kgs, and sum all ions to get the mass of all solutes in 1 kgs of solution $\\alpha$ kg. Subtract $\\alpha$ kg from 1 kgs of solution to get the mass of pure water as (1-$\\alpha$) kgw. Now we know how many moles of various ions are in 1 kgs of solution, divide it by (1-$\\alpha$) kgw to get the corresponding concentration of various ions under 1 kgw of pure water, that is, mol/kgw. To verify the above logic, a simple calculation is as follows using Python:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # Assume 1 kg solution concentrations = { \"Ca\": 0.7, # mol/kgs \"Na\": 0.889, \"Mg\": 0.2, \"Cl\": 0.4, \"C(4)\": 0.2, \"S(6)\": 0.256, } molar_masses = { \"K\": 39.098, # g/mol \"Na\": 22.990, \"Ca\": 40.078, \"Mg\": 24.305, \"Li\": 6.94, \"Cl\": 35.45, \"S(6)\": 96.056, \"C(4)\": 60.008 } # Calculate the sum of the masses of each ion total_mass = sum(concentrations[element] * molar_masses[element] for element in concentrations) / 1000 # The mass of water in 1kg solution is water_mass = 1 - total_mass ions_mass = {element: concentration / water_mass for element, concentration in concentrations.items()} The output is:\n1 2 3 4 5 6 7 8 9 10 11 12 13 {'Ca': 0.7813595699827344, 'Na': 0.9923266538780727, 'Mg': 0.22324559142363842, 'Cl': 0.44649118284727685, 'C(4)': 0.22324559142363842, 'S(6)': 0.28575435702225715} {'Ca': 0.7814, 'Na': 0.9923, 'Mg': 0.2232, 'Cl': 0.4465, 'C(4)': 0.2232, 'S(6)': 0.2858} At this time, it is basically the same as the PHREEQC calculation result. As for why each ion has a deviation of 0.0001-0.0003, I guess it may be related to the rounding of the molar mass and the choice of the database.\n3 Input Unit is mg/L or mol/L In actual work, the most commonly used units are mol/L or mg/L. But this situation is the most complicated in PHREEQC, because our input density value comes into play at this time.\nAs mentioned earlier, since databases such as phreeqc.dat and pitzer.dat have definitions of molar volume for solution components, PHREEQC can automatically calculate the density. However, the process of calculating density internally in PHREEQC is more complicated and will not be discussed too much here. We only analyze how the output result is converted when the input density value is given.\nThe input density is regarded as the input density, and the density calculated by PHREEQC is regarded as the calculated density.\nThe density here refers to the density of the solution, it cannot be the density of pure water, and it is meaningless to discuss the density of pure water. The input density and calculated density of PHREEQC are also solution densities.\nStill taking the case of the previous section as an example, just change the concentration unit to mol/L and set the density to 1.2 kgs/m$^3$:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 SOLUTION 1 -water 1 -temp 25 -units mol/L density 1.2 pH 7 pe 4.0 Ca 0.7 Na 0.889 Mg 0.2 C(4) 0.2 S(6) 0.256 Cl 0.4 END In this post on the forum Density calculation and mole concentration of components and Converting from molality (mol/kgw) to mg/l for high solubility minerals, I saw the PHREEQC developer say this sentence:\nDensity is used to convert mg/L to mg/kgs. Then, the sum of the solutes is subtracted from the kilogram of solution to get the mass of water. Finally, the masses are scaled to produce 1 kg of water.\nHe means that our input density is only used to convert the input unit from xx/L to xx/kgs. Then, as we discussed in the previous section, the unit is converted to xx/kgw, that is, scaled to the molar concentration when 1 kg of water is produced.\nThis shows that the input density only plays an initial conversion role, and PHREEQC will still calculate the density itself. The steps at this time should be:\nDivide the input ion concentration mol/L by the input density kg/m$^3$, remove the volume, and get mol/kgs. Follow the calculation steps in the previous section to obtain the concentration of various ions under 1 kgw of pure water, that is, mol/kgw. The Python script for verification is as follows:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 concentrations = { \"Ca\": 0.7 / 1.2, # mol/L / density kg/m^3 \"Na\": 0.889 / 1.2, \"Mg\": 0.2 / 1.2, \"Cl\": 0.4 / 1.2, \"C(4)\": 0.2 / 1.2, \"S(6)\": 0.256 / 1.2, } molar_masses = { \"K\": 39.098, # g/mol \"Na\": 22.990, \"Ca\": 40.078, \"Mg\": 24.305, \"Li\": 6.94, \"Cl\": 35.45, \"S(6)\": 96.056, \"C(4)\": 60.008 } total_mass = sum(concentrations[element] * molar_masses[element] for element in concentrations) / 1000 water_mass = 1 - total_mass normalized_ions_mass = {element: concentration / water_mass for element, concentration in concentrations.items()} normalized_ions_mass The output is:\n1 2 3 4 5 6 'Ca': 0.6387593590861604, 'Na': 0.8112243860394237, 'Mg': 0.18250267402461728, 'Cl': 0.36500534804923457, 'C(4)': 0.18250267402461728, 'S(6)': 0.23360342275151008 PHREEQC‚Äôs result is:\n1 2 3 4 5 6 7 Elements Molality Moles C(4) 1.825e-01 1.825e-01 Ca 6.389e-01 6.389e-01 Cl 3.651e-01 3.651e-01 Mg 1.825e-01 1.825e-01 Na 8.114e-01 8.114e-01 S(6) 2.336e-01 2.336e-01 There will still be very small differences, the reason is the same as above.\nAbout the calc Parameter in PHREEQC In PHREEQC version 3.8 and above, if you add a calc after the density, the density calculation of PHREEQC will iteratively tend to the input density.\nBut I haven‚Äôt tested this effect, so I‚Äôm not sure.\nYou can refer to:\nDensity calculation in the Description of solution section of the output Versions 3.8.2 of all PHREEQC programs have been released. Volume in PHREEQC The volume output in PHREEQC is calculated according to its internal logic (including the molar volume of ions and other parameters), and has nothing to do with our density.\nIn the SOLUTION keyword, a -water parameter will be input. This -water refers to the defined mass of pure water, and according to the calculation logic of density and concentration in the front, this parameter will not affect the result of Molality, it will only affect Moles.\nFor example, taking the above case as an example, increase -water by 10 times and 100 times respectively:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 SOLUTION 1 -water 10 -temp 25 -units mol/kgw density 2 pH 7 pe 4.0 Ca 0.7 Na 0.889 Mg 0.2 C(4) 0.2 S(6) 0.256 Cl 0.4 END The calculation result at this time is:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # -water 10 Elements Molality Moles C(4) 2.000e-01 2.000e+00 Ca 7.000e-01 7.000e+00 Cl 4.000e-01 4.000e+00 Mg 2.000e-01 2.000e+00 Na 8.890e-01 8.890e+00 S(6) 2.560e-01 2.560e+00 Density (g/cm3) = 1.09475 Volume (L) = 10.08496 # -water 100 Elements Molality Moles C(4) 2.000e-01 2.000e+01 Ca 7.000e-01 7.000e+01 Cl 4.000e-01 4.000e+01 Mg 2.000e-01 2.000e+01 Na 8.890e-01 8.890e+01 S(6) 2.560e-01 2.560e+01 Density (g/cm3) = 1.09475 Volume (L) = 100.84961 It can be seen that only Moles are increasing, which has no effect on Molality. The volume also increases in proportion to the mass.\nFrom this, we can know that in PHREEQC, we cannot freely control the volume input. PHREEQC will automatically calculate the density and volume according to the needs. However, as the mass of pure water -water increases, the volume also increases.\nIn the process of reactive transport, mol/L cannot be input casually. If you must specify the solution volume and input mol/L, you need to deal with it according to the following conditions:\nSuppose the solution volume of a certain calculation is known to be $m$ L. If it is a dilute solution, it can be regarded as $m$ L of pure water. At this time, just input -water 0.001*m kgw. If it is a concentrated solution, you need to ensure that you measure the accurate density of the solution, and then convert $m$ L of the solution into $kgs$. On this basis, subtract the mass of the solute to get the mass of pure water kgw, and assign it to -water, in order to ensure that the Moles calculated by PHREEQC meets expectations. Convert Output Results to mol/L The output of PHREEQC is mol/kgw by default, and there are no optional units.\nIf you must convert to mol/L, you can use the PUNCH keyword, for example:\n1 10 PUNCH TOT(\"K\") * TOT(\"water\") / SOLN_VOL Where TOT refers to the Molality of the ion, the unit is mol/kgw, TOT(\"water\") specifically refers to the mass of pure water, kgw. SOLN_VOL is the volume of the solution, calculated by PHREEQC.\n","wordCount":"2282","inLanguage":"en","datePublished":"2025-01-22T00:00:00Z","dateModified":"2025-01-22T00:00:00Z","author":{"@type":"Person","name":"Zitao Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wangzitao21.github.io/en/calculation-logic-of-density-in-phreeqc/"},"publisher":{"@type":"Organization","name":"Wang's Blog","logo":{"@type":"ImageObject","url":"https://wangzitao21.github.io/favicon/favicon16x16.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangzitao21.github.io/en/ accesskey=h title="Wang's Blog (Alt + H)">Wang's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://wangzitao21.github.io/zh/ title="üåê ÂàáÊç¢‰∏∫‰∏≠Êñá" aria-label="üåê ÂàáÊç¢‰∏∫‰∏≠Êñá">üåê ÂàáÊç¢‰∏∫‰∏≠Êñá</a></li></ul></div></div><ul id=menu><li><a href=https://wangzitao21.github.io/en/ title=üè†Home><span>üè†Home</span></a></li><li><a href=https://wangzitao21.github.io/en/search title="üîéSearch (Alt + /)" accesskey=/><span>üîéSearch</span></a></li><li><a href=https://wangzitao21.github.io/en/archives title=üìöArchives><span>üìöArchives</span></a></li><li><a href=https://wangzitao21.github.io/en/tags title=üß©Ô∏èTags><span>üß©Ô∏èTags</span></a></li><li><a href=https://wangzitao21.github.io/en/about title=üë§About><span>üë§About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wangzitao21.github.io/en/>Home</a>&nbsp;¬ª&nbsp;<a href=https://wangzitao21.github.io/en/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Calculation Logic of Density in PHREEQC</h1><div class=post-meta><span title='2025-01-22 00:00:00 +0000 UTC'>1/22/2025</span>&nbsp;¬∑&nbsp;Zitao Wang&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://wangzitao21.github.io/zh/phreeqc-%E4%B8%AD%E5%AF%86%E5%BA%A6%E7%9A%84%E8%AE%A1%E7%AE%97%E9%80%BB%E8%BE%91/>üåê ÂàáÊç¢‰∏∫‰∏≠Êñá</a></li></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#background aria-label=Background>Background</a></li><li><a href=#three-scenarios-of-density-calculation aria-label="Three Scenarios of Density Calculation">Three Scenarios of Density Calculation</a><ul><li><a href=#1-input-unit-is-mgkgw-or-molkgw aria-label="1 Input Unit is mg/kgw or mol/kgw">1 Input Unit is mg/kgw or mol/kgw</a></li><li><a href=#2-input-unit-is-mgkgs-or-molkgs aria-label="2 Input Unit is mg/kgs or mol/kgs">2 Input Unit is mg/kgs or mol/kgs</a></li><li><a href=#3-input-unit-is-mgl-or-moll aria-label="3 Input Unit is mg/L or mol/L">3 Input Unit is mg/L or mol/L</a></li></ul></li><li><a href=#about-the-calc-parameter-in-phreeqc aria-label="About the calc Parameter in PHREEQC">About the calc Parameter in PHREEQC</a></li><li><a href=#volume-in-phreeqc aria-label="Volume in PHREEQC">Volume in PHREEQC</a></li><li><a href=#convert-output-results-to-moll aria-label="Convert Output Results to mol/L">Convert Output Results to mol/L</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>The way PHREEQC calculates density has always puzzled me. Sometimes, I input a density value A, but the output density is B. Then, when I change the input density to B, the output density becomes C.</p><p>After repeatedly consulting the <a href=https://www.phreeqcusers.org/>PHREEQC Users</a> forum, I have basically figured out the calculation logic of density. Here is my summary.</p><h1 id=background>Background<a hidden class=anchor aria-hidden=true href=#background>#</a></h1><p>In PHREEQC, there are two units for measuring the mass of a liquid: <code>kgw</code> and <code>kgs</code>.</p><p>Assuming that the solvent is pure water, then:</p><ul><li><code>kgw</code> refers to 1 kg of pure water. c($x$)=1 mmol/kgw means that one kilogram of pure water contains 1 mmol of $x$.</li><li><code>kgs</code> refers to 1 kg of solution, which includes both solute and pure water. c($x$)=1 mmol/kgs means that one kilogram of solution (mass of pure water + solute) contains 1 mmol of $x$.</li></ul><p>When the solution is a dilute solution, the mass of the solute can be ignored. In this case, the density, viscosity, and other properties of pure water are the properties of the solution.</p><p>Only when the solute concentration is very high and has seriously affected the mass of the solution will the mass of the solution be much greater than the mass of pure water, and the density will differ greatly.</p><p>In PHREEQC, Molality, Activity, and Moles are output. Among them, Molality refers to the number of moles of solute per kilogram of solvent, that is, mol/kgw; Moles refers to the total number of moles of elements in the entire solution, that is, mol; Activity refers to the ion activity, the unit is the same as Molality.</p><h1 id=three-scenarios-of-density-calculation>Three Scenarios of Density Calculation<a hidden class=anchor aria-hidden=true href=#three-scenarios-of-density-calculation>#</a></h1><p>According to the different input units, I divide the calculation logic of PHREEQC into three situations:</p><h2 id=1-input-unit-is-mgkgw-or-molkgw>1 Input Unit is mg/kgw or mol/kgw<a hidden class=anchor aria-hidden=true href=#1-input-unit-is-mgkgw-or-molkgw>#</a></h2><p>When the input solution unit is mg/kgw or mol/kgw, the input density has no effect on the display of PHREEQC, and the input concentration is equal to the Molality finally calculated by PHREEQC.</p><p>For example, we input the following solution, using the database <code>pitzer.dat</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>SOLUTION 1
</span></span><span class=line><span class=cl>    -water 1
</span></span><span class=line><span class=cl>    -temp 25
</span></span><span class=line><span class=cl>    -units mol/kgw
</span></span><span class=line><span class=cl>    density 1
</span></span><span class=line><span class=cl>    pH 7
</span></span><span class=line><span class=cl>    pe 4.0
</span></span><span class=line><span class=cl>    Ca 0.7
</span></span><span class=line><span class=cl>    Na 0.889
</span></span><span class=line><span class=cl>    Mg 0.2
</span></span><span class=line><span class=cl>    C(4) 0.2
</span></span><span class=line><span class=cl>    S(6) 0.256
</span></span><span class=line><span class=cl>    Cl 0.4
</span></span><span class=line><span class=cl>END
</span></span></code></pre></td></tr></table></div></div><p>At this time, we don&rsquo;t care about the ion speciation, only look at the concentration results:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>-----------------------------Solution composition------------------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	Elements           Molality       Moles
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	C(4)              2.000e-01   2.000e-01
</span></span><span class=line><span class=cl>	Ca                7.000e-01   7.000e-01
</span></span><span class=line><span class=cl>	Cl                4.000e-01   4.000e-01
</span></span><span class=line><span class=cl>	Mg                2.000e-01   2.000e-01
</span></span><span class=line><span class=cl>	Na                8.890e-01   8.890e-01
</span></span><span class=line><span class=cl>	S(6)              2.560e-01   2.560e-01
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>----------------------------Description of solution----------------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                       pH  =   7.000    
</span></span><span class=line><span class=cl>                                       pe  =   4.000    
</span></span><span class=line><span class=cl>                          Density (g/cm3)  =   1.09475
</span></span><span class=line><span class=cl>                               Volume (L)  =   1.00850
</span></span><span class=line><span class=cl>                       Mass of water (kg)  =   1.000e+00
</span></span></code></pre></td></tr></table></div></div><p>Try to modify the input density and you will find that no matter what the input density is, the output solution density and volume will not change. This is because PHREEQC does not use our input density at all. It will automatically calculate the volume and density of the input solution based on the molar concentration and moles of the solute.</p><p>If the above input unit is changed from mol/kgw to mg/kgw, the output result is:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>-----------------------------Solution composition------------------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	Elements           Molality       Moles
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	C(4)              3.278e-06   3.278e-06
</span></span><span class=line><span class=cl>	Ca                1.747e-05   1.747e-05
</span></span><span class=line><span class=cl>	Cl                1.128e-05   1.128e-05
</span></span><span class=line><span class=cl>	Mg                8.229e-06   8.229e-06
</span></span><span class=line><span class=cl>	Na                3.867e-05   3.867e-05
</span></span><span class=line><span class=cl>	S(6)              2.665e-06   2.665e-06
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>----------------------------Description of solution----------------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                       pH  =   7.000    
</span></span><span class=line><span class=cl>                                       pe  =   4.000    
</span></span><span class=line><span class=cl>                          Density (g/cm3)  =   0.99705
</span></span><span class=line><span class=cl>                               Volume (L)  =   1.00297
</span></span><span class=line><span class=cl>                       Mass of water (kg)  =   1.000e+00
</span></span></code></pre></td></tr></table></div></div><p>At this time, the Solution composition part will be automatically converted to mol/kgw by PHREEQC, and the volume and density are also automatically calculated.</p><p>In summary, if the input unit is mg/kgw or mol/kgw, PHREEQC will calculate the density itself, and no matter what density is input, it will be ignored.</p><h2 id=2-input-unit-is-mgkgs-or-molkgs>2 Input Unit is mg/kgs or mol/kgs<a hidden class=anchor aria-hidden=true href=#2-input-unit-is-mgkgs-or-molkgs>#</a></h2><p>When our input solution unit is mg/kgs or mol/kgs, the input density has no effect on the display of PHREEQC either, because there is no volume calculation involved. But at this time, the input solute concentration is not equal to the Molality finally calculated by PHREEQC, and conversion is required.</p><p>Taking the following solution as an example, the conversion method of PHREEQC is explained:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>SOLUTION <span class=m>1</span>
</span></span><span class=line><span class=cl>    -water <span class=m>1</span>
</span></span><span class=line><span class=cl>    -temp <span class=m>25</span>
</span></span><span class=line><span class=cl>    -units mol/kgs
</span></span><span class=line><span class=cl>    density <span class=m>1</span>
</span></span><span class=line><span class=cl>    pH <span class=m>7</span>
</span></span><span class=line><span class=cl>    pe 4.0
</span></span><span class=line><span class=cl>    Ca 0.7
</span></span><span class=line><span class=cl>    Na 0.889
</span></span><span class=line><span class=cl>    Mg 0.2
</span></span><span class=line><span class=cl>    C<span class=o>(</span>4<span class=o>)</span> 0.2
</span></span><span class=line><span class=cl>    S<span class=o>(</span>6<span class=o>)</span> 0.256
</span></span><span class=line><span class=cl>    Cl 0.4
</span></span><span class=line><span class=cl>END
</span></span></code></pre></td></tr></table></div></div><p>Run the above script in PHREEQC, and the result is as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Elements           Molality       Moles
</span></span><span class=line><span class=cl>C<span class=o>(</span>4<span class=o>)</span>              2.233e-01   2.233e-01
</span></span><span class=line><span class=cl>Ca                7.815e-01   7.815e-01
</span></span><span class=line><span class=cl>Cl                4.466e-01   4.466e-01
</span></span><span class=line><span class=cl>Mg                2.233e-01   2.233e-01
</span></span><span class=line><span class=cl>Na                9.926e-01   9.926e-01
</span></span><span class=line><span class=cl>S<span class=o>(</span>6<span class=o>)</span>              2.858e-01   2.858e-01
</span></span></code></pre></td></tr></table></div></div><p>It can be seen that the calculation result of PHREEQC is larger than the input concentration. The calculation logic here should be:</p><ol><li>First convert the solute concentration from mol/kgs to kg/kgs, and sum all ions to get the mass of all solutes in 1 kgs of solution $\alpha$ kg.</li><li>Subtract $\alpha$ kg from 1 kgs of solution to get the mass of pure water as (1-$\alpha$) kgw.</li><li>Now we know how many moles of various ions are in 1 kgs of solution, divide it by (1-$\alpha$) kgw to get the corresponding concentration of various ions under 1 kgw of pure water, that is, mol/kgw.</li></ol><p>To verify the above logic, a simple calculation is as follows using Python:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Assume 1 kg solution</span>
</span></span><span class=line><span class=cl><span class=n>concentrations</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Ca&#34;</span><span class=p>:</span> <span class=mf>0.7</span><span class=p>,</span>  <span class=c1># mol/kgs</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Na&#34;</span><span class=p>:</span> <span class=mf>0.889</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Mg&#34;</span><span class=p>:</span> <span class=mf>0.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Cl&#34;</span><span class=p>:</span> <span class=mf>0.4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;C(4)&#34;</span><span class=p>:</span> <span class=mf>0.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;S(6)&#34;</span><span class=p>:</span> <span class=mf>0.256</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>molar_masses</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;K&#34;</span><span class=p>:</span> <span class=mf>39.098</span><span class=p>,</span> <span class=c1># g/mol</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Na&#34;</span><span class=p>:</span> <span class=mf>22.990</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Ca&#34;</span><span class=p>:</span> <span class=mf>40.078</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Mg&#34;</span><span class=p>:</span> <span class=mf>24.305</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Li&#34;</span><span class=p>:</span> <span class=mf>6.94</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Cl&#34;</span><span class=p>:</span> <span class=mf>35.45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;S(6)&#34;</span><span class=p>:</span> <span class=mf>96.056</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;C(4)&#34;</span><span class=p>:</span> <span class=mf>60.008</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Calculate the sum of the masses of each ion</span>
</span></span><span class=line><span class=cl><span class=n>total_mass</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>concentrations</span><span class=p>[</span><span class=n>element</span><span class=p>]</span> <span class=o>*</span> <span class=n>molar_masses</span><span class=p>[</span><span class=n>element</span><span class=p>]</span> <span class=k>for</span> <span class=n>element</span> <span class=ow>in</span> <span class=n>concentrations</span><span class=p>)</span> <span class=o>/</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The mass of water in 1kg solution is</span>
</span></span><span class=line><span class=cl><span class=n>water_mass</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>total_mass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ions_mass</span> <span class=o>=</span> <span class=p>{</span><span class=n>element</span><span class=p>:</span> <span class=n>concentration</span> <span class=o>/</span> <span class=n>water_mass</span> <span class=k>for</span> <span class=n>element</span><span class=p>,</span> <span class=n>concentration</span> <span class=ow>in</span> <span class=n>concentrations</span><span class=o>.</span><span class=n>items</span><span class=p>()}</span>
</span></span></code></pre></td></tr></table></div></div><p>The output is:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{</span><span class=s1>&#39;Ca&#39;</span><span class=p>:</span> <span class=mf>0.7813595699827344</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Na&#39;</span><span class=p>:</span> <span class=mf>0.9923266538780727</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Mg&#39;</span><span class=p>:</span> <span class=mf>0.22324559142363842</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Cl&#39;</span><span class=p>:</span> <span class=mf>0.44649118284727685</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;C(4)&#39;</span><span class=p>:</span> <span class=mf>0.22324559142363842</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;S(6)&#39;</span><span class=p>:</span> <span class=mf>0.28575435702225715</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s1>&#39;Ca&#39;</span><span class=p>:</span> <span class=mf>0.7814</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Na&#39;</span><span class=p>:</span> <span class=mf>0.9923</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Mg&#39;</span><span class=p>:</span> <span class=mf>0.2232</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Cl&#39;</span><span class=p>:</span> <span class=mf>0.4465</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;C(4)&#39;</span><span class=p>:</span> <span class=mf>0.2232</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;S(6)&#39;</span><span class=p>:</span> <span class=mf>0.2858</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>At this time, it is basically the same as the PHREEQC calculation result. As for why each ion has a deviation of 0.0001-0.0003, I guess it may be related to the rounding of the molar mass and the choice of the database.</p><h2 id=3-input-unit-is-mgl-or-moll>3 Input Unit is mg/L or mol/L<a hidden class=anchor aria-hidden=true href=#3-input-unit-is-mgl-or-moll>#</a></h2><p>In actual work, the most commonly used units are mol/L or mg/L. But this situation is the most complicated in PHREEQC, because our input density value comes into play at this time.</p><p>As mentioned earlier, since databases such as <code>phreeqc.dat</code> and <code>pitzer.dat</code> have definitions of molar volume for solution components, PHREEQC can automatically calculate the density. However, the process of calculating density internally in PHREEQC is more complicated and will not be discussed too much here. We only analyze how the output result is converted when the input density value is given.</p><p>The input density is regarded as the input density, and the density calculated by PHREEQC is regarded as the calculated density.</p><blockquote><p>The density here refers to the density of the solution, it cannot be the density of pure water, and it is meaningless to discuss the density of pure water. The input density and calculated density of PHREEQC are also solution densities.</p></blockquote><p>Still taking the case of the previous section as an example, just change the concentration unit to mol/L and set the density to 1.2 kgs/m$^3$:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>SOLUTION <span class=m>1</span>
</span></span><span class=line><span class=cl>    -water <span class=m>1</span>
</span></span><span class=line><span class=cl>    -temp <span class=m>25</span>
</span></span><span class=line><span class=cl>    -units mol/L
</span></span><span class=line><span class=cl>    density 1.2
</span></span><span class=line><span class=cl>    pH <span class=m>7</span>
</span></span><span class=line><span class=cl>    pe 4.0
</span></span><span class=line><span class=cl>    Ca 0.7
</span></span><span class=line><span class=cl>    Na 0.889
</span></span><span class=line><span class=cl>    Mg 0.2
</span></span><span class=line><span class=cl>    C<span class=o>(</span>4<span class=o>)</span> 0.2
</span></span><span class=line><span class=cl>    S<span class=o>(</span>6<span class=o>)</span> 0.256
</span></span><span class=line><span class=cl>    Cl 0.4
</span></span><span class=line><span class=cl>END
</span></span></code></pre></td></tr></table></div></div><p>In this post on the forum <a href=https://phreeqcusers.org/index.php/topic,2218.msg8194.html#msg8194>Density calculation and mole concentration of components</a> and <a href="https://phreeqcusers.org/index.php?topic=64.0">Converting from molality (mol/kgw) to mg/l for high solubility minerals</a>, I saw the PHREEQC developer say this sentence:</p><blockquote><p>Density is used to convert mg/L to mg/kgs. Then, the sum of the solutes is subtracted from the kilogram of solution to get the mass of water. Finally, the masses are scaled to produce 1 kg of water.</p></blockquote><p>He means that our input density is only used to convert the input unit from xx/L to xx/kgs. Then, as we discussed in the previous section, the unit is converted to xx/kgw, that is, scaled to the molar concentration when 1 kg of water is produced.</p><p>This shows that the input density only plays an initial conversion role, and PHREEQC will still calculate the density itself. The steps at this time should be:</p><ol><li>Divide the input ion concentration mol/L by the input density kg/m$^3$, remove the volume, and get mol/kgs.</li><li>Follow the calculation steps in the previous section to obtain the concentration of various ions under 1 kgw of pure water, that is, mol/kgw.</li></ol><p>The Python script for verification is as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>concentrations</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Ca&#34;</span><span class=p>:</span> <span class=mf>0.7</span> <span class=o>/</span> <span class=mf>1.2</span><span class=p>,</span>  <span class=c1># mol/L / density kg/m^3</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Na&#34;</span><span class=p>:</span> <span class=mf>0.889</span> <span class=o>/</span> <span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Mg&#34;</span><span class=p>:</span> <span class=mf>0.2</span> <span class=o>/</span> <span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Cl&#34;</span><span class=p>:</span> <span class=mf>0.4</span> <span class=o>/</span> <span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;C(4)&#34;</span><span class=p>:</span> <span class=mf>0.2</span> <span class=o>/</span> <span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;S(6)&#34;</span><span class=p>:</span> <span class=mf>0.256</span> <span class=o>/</span> <span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>molar_masses</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;K&#34;</span><span class=p>:</span> <span class=mf>39.098</span><span class=p>,</span> <span class=c1># g/mol</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Na&#34;</span><span class=p>:</span> <span class=mf>22.990</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Ca&#34;</span><span class=p>:</span> <span class=mf>40.078</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Mg&#34;</span><span class=p>:</span> <span class=mf>24.305</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Li&#34;</span><span class=p>:</span> <span class=mf>6.94</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Cl&#34;</span><span class=p>:</span> <span class=mf>35.45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;S(6)&#34;</span><span class=p>:</span> <span class=mf>96.056</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;C(4)&#34;</span><span class=p>:</span> <span class=mf>60.008</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>total_mass</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>concentrations</span><span class=p>[</span><span class=n>element</span><span class=p>]</span> <span class=o>*</span> <span class=n>molar_masses</span><span class=p>[</span><span class=n>element</span><span class=p>]</span> <span class=k>for</span> <span class=n>element</span> <span class=ow>in</span> <span class=n>concentrations</span><span class=p>)</span> <span class=o>/</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=n>water_mass</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>total_mass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>normalized_ions_mass</span> <span class=o>=</span> <span class=p>{</span><span class=n>element</span><span class=p>:</span> <span class=n>concentration</span> <span class=o>/</span> <span class=n>water_mass</span> <span class=k>for</span> <span class=n>element</span><span class=p>,</span> <span class=n>concentration</span> <span class=ow>in</span> <span class=n>concentrations</span><span class=o>.</span><span class=n>items</span><span class=p>()}</span>
</span></span><span class=line><span class=cl><span class=n>normalized_ions_mass</span>
</span></span></code></pre></td></tr></table></div></div><p>The output is:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#39;Ca&#39;: 0.6387593590861604,
</span></span><span class=line><span class=cl>&#39;Na&#39;: 0.8112243860394237,
</span></span><span class=line><span class=cl>&#39;Mg&#39;: 0.18250267402461728,
</span></span><span class=line><span class=cl>&#39;Cl&#39;: 0.36500534804923457,
</span></span><span class=line><span class=cl>&#39;C(4)&#39;: 0.18250267402461728,
</span></span><span class=line><span class=cl>&#39;S(6)&#39;: 0.23360342275151008
</span></span></code></pre></td></tr></table></div></div><p>PHREEQC&rsquo;s result is:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Elements           Molality       Moles
</span></span><span class=line><span class=cl>C(4)              1.825e-01   1.825e-01
</span></span><span class=line><span class=cl>Ca                6.389e-01   6.389e-01
</span></span><span class=line><span class=cl>Cl                3.651e-01   3.651e-01
</span></span><span class=line><span class=cl>Mg                1.825e-01   1.825e-01
</span></span><span class=line><span class=cl>Na                8.114e-01   8.114e-01
</span></span><span class=line><span class=cl>S(6)              2.336e-01   2.336e-01
</span></span></code></pre></td></tr></table></div></div><p>There will still be very small differences, the reason is the same as above.</p><h1 id=about-the-calc-parameter-in-phreeqc>About the calc Parameter in PHREEQC<a hidden class=anchor aria-hidden=true href=#about-the-calc-parameter-in-phreeqc>#</a></h1><p>In PHREEQC version 3.8 and above, if you add a <code>calc</code> after the density, the density calculation of PHREEQC will iteratively tend to the input density.</p><p>But I haven&rsquo;t tested this effect, so I&rsquo;m not sure.</p><p>You can refer to:</p><ul><li><a href=https://phreeqcusers.org/index.php/topic,2574.msg9675.html#msg9675>Density calculation in the Description of solution section of the output</a></li><li><a href=https://phreeqcusers.org/index.php/topic,2544.0.html>Versions 3.8.2 of all PHREEQC programs have been released</a>.</li></ul><h1 id=volume-in-phreeqc>Volume in PHREEQC<a hidden class=anchor aria-hidden=true href=#volume-in-phreeqc>#</a></h1><p>The volume output in PHREEQC is calculated according to its internal logic (including the molar volume of ions and other parameters), and has nothing to do with our density.</p><p>In the <code>SOLUTION</code> keyword, a <code>-water</code> parameter will be input. This <code>-water</code> refers to the defined mass of pure water, and according to the calculation logic of density and concentration in the front, this parameter will not affect the result of Molality, it will only affect Moles.</p><p>For example, taking the above case as an example, increase <code>-water</code> by 10 times and 100 times respectively:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>SOLUTION 1
</span></span><span class=line><span class=cl>    -water 10
</span></span><span class=line><span class=cl>    -temp 25
</span></span><span class=line><span class=cl>    -units mol/kgw
</span></span><span class=line><span class=cl>    density 2
</span></span><span class=line><span class=cl>    pH 7
</span></span><span class=line><span class=cl>    pe 4.0
</span></span><span class=line><span class=cl>    Ca 0.7
</span></span><span class=line><span class=cl>    Na 0.889
</span></span><span class=line><span class=cl>    Mg 0.2
</span></span><span class=line><span class=cl>    C(4) 0.2
</span></span><span class=line><span class=cl>    S(6) 0.256
</span></span><span class=line><span class=cl>    Cl 0.4
</span></span><span class=line><span class=cl>END
</span></span></code></pre></td></tr></table></div></div><p>The calculation result at this time is:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># -water 10
</span></span><span class=line><span class=cl>Elements           Molality       Moles
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C(4)              2.000e-01   2.000e+00
</span></span><span class=line><span class=cl>Ca                7.000e-01   7.000e+00
</span></span><span class=line><span class=cl>Cl                4.000e-01   4.000e+00
</span></span><span class=line><span class=cl>Mg                2.000e-01   2.000e+00
</span></span><span class=line><span class=cl>Na                8.890e-01   8.890e+00
</span></span><span class=line><span class=cl>S(6)              2.560e-01   2.560e+00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Density (g/cm3)  =  1.09475
</span></span><span class=line><span class=cl>     Volume (L)  =  10.08496
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># -water 100
</span></span><span class=line><span class=cl>Elements           Molality       Moles
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C(4)              2.000e-01   2.000e+01
</span></span><span class=line><span class=cl>Ca                7.000e-01   7.000e+01
</span></span><span class=line><span class=cl>Cl                4.000e-01   4.000e+01
</span></span><span class=line><span class=cl>Mg                2.000e-01   2.000e+01
</span></span><span class=line><span class=cl>Na                8.890e-01   8.890e+01
</span></span><span class=line><span class=cl>S(6)              2.560e-01   2.560e+01
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Density (g/cm3)  =  1.09475
</span></span><span class=line><span class=cl>     Volume (L)  =  100.84961
</span></span></code></pre></td></tr></table></div></div><p>It can be seen that only Moles are increasing, which has no effect on Molality. The volume also increases in proportion to the mass.</p><p>From this, we can know that in PHREEQC, we cannot freely control the volume input. PHREEQC will automatically calculate the density and volume according to the needs. However, as the mass of pure water <code>-water</code> increases, the volume also increases.</p><p>In the process of reactive transport, mol/L cannot be input casually. If you must specify the solution volume and input mol/L, you need to deal with it according to the following conditions:</p><ul><li>Suppose the solution volume of a certain calculation is known to be $m$ L. If it is a dilute solution, it can be regarded as $m$ L of pure water. At this time, just input <code>-water 0.001*m kgw</code>.</li><li>If it is a concentrated solution, you need to ensure that you measure the accurate density of the solution, and then convert $m$ L of the solution into $kgs$. On this basis, subtract the mass of the solute to get the mass of pure water kgw, and assign it to <code>-water</code>, in order to ensure that the Moles calculated by PHREEQC meets expectations.</li></ul><h1 id=convert-output-results-to-moll>Convert Output Results to mol/L<a hidden class=anchor aria-hidden=true href=#convert-output-results-to-moll>#</a></h1><p>The output of PHREEQC is mol/kgw by default, and there are no optional units.</p><p>If you must convert to mol/L, you can use the <code>PUNCH</code> keyword, for example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=m>10</span> PUNCH TOT<span class=o>(</span><span class=s2>&#34;K&#34;</span><span class=o>)</span>  * TOT<span class=o>(</span><span class=s2>&#34;water&#34;</span><span class=o>)</span> / SOLN_VOL
</span></span></code></pre></td></tr></table></div></div><p>Where <code>TOT</code> refers to the Molality of the ion, the unit is mol/kgw, <code>TOT("water")</code> specifically refers to the mass of pure water, kgw. <code>SOLN_VOL</code> is the volume of the solution, calculated by PHREEQC.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangzitao21.github.io/en/tags/phreeqc/>PHREEQC</a></li></ul><nav class=paginav><a class=prev href=https://wangzitao21.github.io/en/principles-and-access-process-of-the-ssh-protocol/><span class=title>¬´ Prev</span><br><span>Principles and Access Process of the SSH Protocol</span>
</a><a class=next href=https://wangzitao21.github.io/en/how-to-refresh-environment-variables-without-restarting-windows/><span class=title>Next ¬ª</span><br><span>How to Refresh Environment Variables Without Restarting Windows</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=wangzitao21/wangzitao21.github.io data-repo-id=R_kgDONoUNzQ data-category=Announcements data-category-id=DIC_kwDONoUNzc4Cl6-6 data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>