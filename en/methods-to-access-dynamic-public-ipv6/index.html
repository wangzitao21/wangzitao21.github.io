<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Methods to Access Dynamic Public IPv6 | Wang's Blog</title><meta name=keywords content="Network,Linux"><meta name=description content="Previously, I set my home&rsquo;s optical modem to bridge mode, switched to router dialing, and turned off the IPv6 firewall, which allowed me to successfully use public IPv6 for inbound connections.
However, the operator provides a dynamic IPv6 prefix of /56, which changes every few days, making it inconvenient to use.
Here are several countermeasures I tried.
DDNS
The best way to solve dynamic IP is to use DDNS, which stands for Dynamic DNS. Here is the specific process."><meta name=author content="Zitao Wang"><link rel=canonical href=https://wangzitao21.github.io/en/methods-to-access-dynamic-public-ipv6/><script type=text/javascript async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"}),MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}})</script><link crossorigin=anonymous href=/assets/css/stylesheet.fd8148162c37b6c614040ca84c7e23ff1f4345bbfc886131f171350edd32073f.css integrity="sha256-/YFIFiw3tsYUBAyoTH4j/x9DRbv8iGEx8XE1Dt0yBz8=" rel="preload stylesheet" as=style><link rel=icon href=https://wangzitao21.github.io/favicon/favicon16x16.gif><link rel=icon type=image/png sizes=16x16 href=https://wangzitao21.github.io/favicon/favicon16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangzitao21.github.io/favicon/favicon32x32.png><link rel=apple-touch-icon href=https://wangzitao21.github.io/favicon/favicon180x180.png><link rel=mask-icon href=https://wangzitao21.github.io/favicon/favicon180x180.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangzitao21.github.io/en/methods-to-access-dynamic-public-ipv6/><link rel=alternate hreflang=zh href=https://wangzitao21.github.io/zh/%E8%A7%A3%E5%86%B3%E5%8A%A8%E6%80%81%E5%85%AC%E7%BD%91-ipv6-%E8%AE%BF%E9%97%AE%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://wangzitao21.github.io/en/methods-to-access-dynamic-public-ipv6/"><meta property="og:site_name" content="Wang's Blog"><meta property="og:title" content="Methods to Access Dynamic Public IPv6"><meta property="og:description" content="Previously, I set my home’s optical modem to bridge mode, switched to router dialing, and turned off the IPv6 firewall, which allowed me to successfully use public IPv6 for inbound connections.
However, the operator provides a dynamic IPv6 prefix of /56, which changes every few days, making it inconvenient to use.
Here are several countermeasures I tried.
DDNS The best way to solve dynamic IP is to use DDNS, which stands for Dynamic DNS. Here is the specific process."><meta property="og:locale" content="en-US"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-01-26T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-26T00:00:00+00:00"><meta property="article:tag" content="Network"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="Methods to Access Dynamic Public IPv6"><meta name=twitter:description content="Previously, I set my home&rsquo;s optical modem to bridge mode, switched to router dialing, and turned off the IPv6 firewall, which allowed me to successfully use public IPv6 for inbound connections.
However, the operator provides a dynamic IPv6 prefix of /56, which changes every few days, making it inconvenient to use.
Here are several countermeasures I tried.
DDNS
The best way to solve dynamic IP is to use DDNS, which stands for Dynamic DNS. Here is the specific process."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangzitao21.github.io/en/post/"},{"@type":"ListItem","position":2,"name":"Methods to Access Dynamic Public IPv6","item":"https://wangzitao21.github.io/en/methods-to-access-dynamic-public-ipv6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Methods to Access Dynamic Public IPv6","name":"Methods to Access Dynamic Public IPv6","description":"Previously, I set my home\u0026rsquo;s optical modem to bridge mode, switched to router dialing, and turned off the IPv6 firewall, which allowed me to successfully use public IPv6 for inbound connections.\nHowever, the operator provides a dynamic IPv6 prefix of /56, which changes every few days, making it inconvenient to use.\nHere are several countermeasures I tried.\nDDNS The best way to solve dynamic IP is to use DDNS, which stands for Dynamic DNS. Here is the specific process.\n","keywords":["Network","Linux"],"articleBody":"Previously, I set my home’s optical modem to bridge mode, switched to router dialing, and turned off the IPv6 firewall, which allowed me to successfully use public IPv6 for inbound connections.\nHowever, the operator provides a dynamic IPv6 prefix of /56, which changes every few days, making it inconvenient to use.\nHere are several countermeasures I tried.\nDDNS The best way to solve dynamic IP is to use DDNS, which stands for Dynamic DNS. Here is the specific process.\n1 Configure Reverse Proxy First, you need to install Nginx and use acme to apply for a domain certificate. It is best to apply for a wildcard domain certificate here so that you can use multiple third-level domains. For specific steps, see [[Nginx (Reverse Proxy) and Acme (Certificate Configuration)]], which will not be repeated in this article.\nThen configure Nginx reverse proxy, the steps are as follows:\nTake the Anki service as an example, which listens on port 27701. Create a configuration file: 1 2 cd /etc/nginx/conf.d \u0026\u0026 \\ vim /etc/nginx/conf.d/anki.conf Write the following configuration. The port number range is 0-65535. Here I will only listen to high ports like 63001 and only use SSL access. HTTP will not be set to listen. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 server { listen 63001 ssl; listen [::]:63001 ssl; server_name anki.example.com; location / { proxy_pass http://127.0.0.1:27701; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_redirect off; proxy_set_header X-Real-Port $remote_port; proxy_set_header HTTP_X_FORWARDED_FOR $remote_addr; proxy_set_header X-NginX-Proxy true; proxy_set_header Accept-Encoding \"\"; } ssl_certificate /root/.acme.sh/example.com_ecc/fullchain.cer; ssl_certificate_key /root/.acme.sh/example.com_ecc/example.com.key; add_header Strict-Transport-Security \"max-age=63072000\" always; } Doing so may cause some devices to fail to redirect from HTTP to HTTPS. You need to manually enter https:// before the domain name.\nIn addition, you need to remember to open port 63001 in the firewall.\n2 Install and Configure DDNS-GO I use the ddns-go project for setup. The Docker command is as follows:\n1 2 3 4 5 6 docker run -d \\ --name ddns-go \\ --restart=always \\ --net=host \\ -v /home/wang/docker_data/ddns-go:/root \\ jeessy2/ddns-go After the container is built, you can directly access the web interface of ddns-go at port 9876 and make the following configurations:\nSelect Cloudflare as the DNS provider. Open the Cloudflare homepage, find “Manage Account” \u003e “Account API Tokens” \u003e “Create Token” \u003e “Edit Zone DNS”, click “Use Template”, and then select your own secondary domain as the zone to include. Copy the generated Token value and paste it into the DDNS-GO web interface. Continue in the web interface, check to enable IPv6, select “Get through network interface”, select the corresponding network interface, fill in the third-level domain name that you need to dynamically resolve at Domains, and then save the above configuration. Try to query your third-level domain IP from the command line: 1 nslookup xxx.example.com 3 About the Risks of DDNS Since DDNS requires domain name configuration and DNS resolution needs to be configured with the domain name provider, in principle, website establishment must be filed with the Ministry of Industry and Information Technology.\nHowever, home equipment cannot be used for filing. In addition, according to online information, operators sometimes detect and block TLS inbound traffic. Therefore, using DDNS may face certain risks.\nThere are several ways to avoid this risk:\nUse high ports. Try not to use commonly used ports such as 80, 443, 8080, and 8443 (these ports are closed by default in some areas). Add an access path to the domain name. For example, xxx.example.com can be changed to only be accessible through xxx.example.com/path, and if no path is entered, a 444 error is returned. Give up public network access and use VPN instead. Using VPN access is undoubtedly the safest, but this method is generally limited to personal use, and sharing it with others will be more troublesome. The Tailscale section below will introduce this practice. Manual DDNS. Configure an SMTP mail server to periodically send the current IPv6 of the server to the mailbox. This is the most brutal approach and can be used as a backup. The following will introduce this practice. Using Tailscale VPN Tailscale is a virtual private network construction tool based on the WireGuard protocol, which can connect devices in different locations to a private network.\nThe biggest advantage of Tailscale is that if both devices have public IPv6, they can connect directly without the need for a third-party server to relay, so the access speed can be guaranteed.\nThe installation of Tailscale is basically not difficult. Just download it normally from the Download page and complete the installation and registration process.\nAfter installing Tailscale on all devices, you can query all online and offline devices in the virtual private network on the Admin console page. From then on, as long as we keep Tailscale running in the background, we can use the local area network domain name or IP to directly access the corresponding service.\nLinux systems can use the following commands to query and turn off/on Tailscale:\n1 2 3 4 5 6 sudo systemctl enable tailscaled sudo systemctl status tailscaled sudo systemctl restart tailscaled sudo systemctl stop tailscaled cat /lib/systemd/system/tailscaled.service Tailscale has many other uses. For me, currently I only need to achieve the purpose of VPN access. I will continue to update it later if needed.\n1 Relay Server For devices without IPv6, Tailscale supports using a relay server. However, the relay servers provided by Tailscale are all abroad, and the delay is difficult to guarantee. We can use the following command to query the official relay server latency:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # Test relay server latency tailscale netcheck # Output as follows Report: * Time: 2025-01-26T10:37:16.276723386Z * UDP: true * IPv4: yes, xxx.xxx.xxx.xxx:26667 * IPv6: yes, [240e:xxxx:xxxx:xxxx::c2]:57110 * MappingVariesByDestIP: false * PortMapping: * CaptivePortal: false * Nearest DERP: Tokyo * DERP latency: - tok: 130.7ms (Tokyo) - sin: 159ms (Singapore) - sfo: 160.1ms (San Francisco) - hkg: 166.8ms (Hong Kong) - lax: 167.9ms (Los Angeles) - sea: 168.2ms (Seattle) - den: 172.6ms (Denver) - ... ... In order to improve the user experience of devices without public IPv6, we can also build a relay server. But for my current situation, there is no need for this at all, so I have not tried it.\n2 File Sharing Tailscale only needs to turn on the “Send Files” function in the General interface to transfer files between online devices in the virtual private network.\nWindows and Android systems will send to the system’s Downloads folder, and Linux systems will send to the following directory:\n1 /var/lib/tailscale/files/Account Email-uid-xxxxxx However, I currently feel that this function is still a bit tasteless. Android still needs to specifically turn on Tailscale to transfer files each time. Although Windows and Linux can be set to start automatically by default, various shared folders can be mounted in advance.\nRegularly Send IPv6 Address by Email In order to prevent the DDNS method from failing, I also prepared a most brutal method, which is to write a simple script in Python to regularly use my Foxmail mailbox to report the current IPv6 address of the server to my Outlook mailbox, so that in special circumstances, pure IP access can be used.\nThe specific steps are as follows:\nFirst, configure the SMTP/IMAP service in Foxmail, just follow the instructions on the official website. Execute the following command to create a Conda environment and install related modules: 1 2 3 conda create -n ddns python=3.11 \u0026\u0026 conda activate ddns pip install requests schedule I wrote a simple Python script here:\n1 vim /home/wang/shell/ddns_mail.py Write the following content:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 import smtplib from email.mime.text import MIMEText import requests import schedule import time # Email configuration SMTP_SERVER = 'smtp.qq.com' # SMTP server address SMTP_PORT = 587 # SMTP server port number EMAIL_ADDRESS = 'xxx@foxmail.com' # Sending email address EMAIL_PASSWORD = \"xxx\" # Email application specific password RECEIVER_EMAIL = 'xxx@outlook.com' # Recipient email address # API for obtaining IPv6 address (can be changed as needed, or obtained directly from local) IPV6_API = 'https://api6.ipify.org' def get_ipv6_address(): \"\"\"Get the IPv6 address of the server.\"\"\" try: response = requests.get(IPV6_API) response.raise_for_status() # Check if the request was successful return response.text.strip() except requests.exceptions.RequestException as e: print(f\"Failed to get IPv6 address: {e}\") return None def send_email(ipv6_address): \"\"\"Send an email containing the IPv6 address.\"\"\" if ipv6_address: message = MIMEText(f\"The current IPv6 address of the server is: {ipv6_address}\") message['Subject'] = 'Server IPv6 Address' message['From'] = EMAIL_ADDRESS message['To'] = RECEIVER_EMAIL server = None try: server = smtplib.SMTP(SMTP_SERVER, SMTP_PORT) server.starttls() # Enable TLS encryption server.login(EMAIL_ADDRESS, EMAIL_PASSWORD) server.sendmail(EMAIL_ADDRESS, RECEIVER_EMAIL, message.as_string()) print(\"Email sent successfully!\") except Exception as e: # Catch a wider range of exceptions print(f\"Email sending failed: ({type(e)}) {e}\") # Output the type of exception finally: if server: try: server.quit() except Exception as e: print(f\"Error closing connection: ({type(e)}) {e}\") else: print(\"Unable to send email, IPv6 address unknown.\") def job(): \"\"\"Scheduled task function, get and send IPv6 address.\"\"\" ipv6_address = get_ipv6_address() send_email(ipv6_address) # Set up scheduled tasks schedule.every().day.at(\"20:17\").do(job) if __name__ == \"__main__\": print(\"The script has been started and will send the IPv6 address regularly every day.\") while True: schedule.run_pending() time.sleep(1) Add a daemon for the above script: 1 sudo vim /etc/systemd/system/ddns_mail.service Write the following content:\n1 2 3 4 5 6 7 8 9 10 11 12 13 [Unit] Description=DDNS Mail After=network.target [Service] Type=simple User=wang WorkingDirectory=/home/wang/shell ExecStart=/home/wang/apps/miniconda3/envs/ddns/bin/python /home/wang/shell/ddns_mail.py \u003e\u003e /home/wang/logs/ddns_mail.log 2\u003e\u00261 Restart=on-failure [Install] WantedBy=multi-user.target Enable or disable process services. 1 2 3 4 5 6 sudo systemctl daemon-reload sudo systemctl enable ddns_mail.service sudo systemctl restart ddns_mail.service sudo systemctl status ddns_mail.service # Query logs journalctl -u ddns_mail.service The above script is currently running normally, but the output log is always empty. I have checked manual execution and permission issues, but I still can’t solve it. I don’t want to delve into the specific reasons for the time being, as long as it can be used normally.\n","wordCount":"1726","inLanguage":"en","datePublished":"2025-01-26T00:00:00Z","dateModified":"2025-01-26T00:00:00Z","author":{"@type":"Person","name":"Zitao Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wangzitao21.github.io/en/methods-to-access-dynamic-public-ipv6/"},"publisher":{"@type":"Organization","name":"Wang's Blog","logo":{"@type":"ImageObject","url":"https://wangzitao21.github.io/favicon/favicon16x16.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangzitao21.github.io/en/ accesskey=h title="Wang's Blog (Alt + H)">Wang's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://wangzitao21.github.io/zh/ title="🌐 切换为中文" aria-label="🌐 切换为中文">🌐 切换为中文</a></li></ul></div></div><ul id=menu><li><a href=https://wangzitao21.github.io/en/ title=🏠Home><span>🏠Home</span></a></li><li><a href=https://wangzitao21.github.io/en/search title="🔎Search (Alt + /)" accesskey=/><span>🔎Search</span></a></li><li><a href=https://wangzitao21.github.io/en/archives title=📚Archives><span>📚Archives</span></a></li><li><a href=https://wangzitao21.github.io/en/tags title=🧩️Tags><span>🧩️Tags</span></a></li><li><a href=https://wangzitao21.github.io/en/about title=👤About><span>👤About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wangzitao21.github.io/en/>Home</a>&nbsp;»&nbsp;<a href=https://wangzitao21.github.io/en/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Methods to Access Dynamic Public IPv6</h1><div class=post-meta><span title='2025-01-26 00:00:00 +0000 UTC'>1/26/2025</span>&nbsp;·&nbsp;Zitao Wang&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://wangzitao21.github.io/zh/%E8%A7%A3%E5%86%B3%E5%8A%A8%E6%80%81%E5%85%AC%E7%BD%91-ipv6-%E8%AE%BF%E9%97%AE%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/>🌐 切换为中文</a></li></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#ddns aria-label=DDNS>DDNS</a><ul><li><a href=#1-configure-reverse-proxy aria-label="1 Configure Reverse Proxy">1 Configure Reverse Proxy</a></li><li><a href=#2-install-and-configure-ddns-go aria-label="2 Install and Configure DDNS-GO">2 Install and Configure DDNS-GO</a></li><li><a href=#3-about-the-risks-of-ddns aria-label="3 About the Risks of DDNS">3 About the Risks of DDNS</a></li></ul></li><li><a href=#using-tailscale-vpn aria-label="Using Tailscale VPN">Using Tailscale VPN</a><ul><li><a href=#1-relay-server aria-label="1 Relay Server">1 Relay Server</a></li><li><a href=#2-file-sharing aria-label="2 File Sharing">2 File Sharing</a></li></ul></li><li><a href=#regularly-send-ipv6-address-by-email aria-label="Regularly Send IPv6 Address by Email">Regularly Send IPv6 Address by Email</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>Previously, I set my home&rsquo;s optical modem to bridge mode, switched to router dialing, and turned off the IPv6 firewall, which allowed me to successfully use public IPv6 for inbound connections.</p><p>However, the operator provides a dynamic IPv6 prefix of /56, which changes every few days, making it inconvenient to use.</p><p>Here are several countermeasures I tried.</p><h1 id=ddns>DDNS<a hidden class=anchor aria-hidden=true href=#ddns>#</a></h1><p>The best way to solve dynamic IP is to use DDNS, which stands for Dynamic DNS. Here is the specific process.</p><h2 id=1-configure-reverse-proxy>1 Configure Reverse Proxy<a hidden class=anchor aria-hidden=true href=#1-configure-reverse-proxy>#</a></h2><p>First, you need to install Nginx and use acme to apply for a domain certificate. It is best to apply for a wildcard domain certificate here so that you can use multiple third-level domains. For specific steps, see [[Nginx (Reverse Proxy) and Acme (Certificate Configuration)]], which will not be repeated in this article.</p><p>Then configure Nginx reverse proxy, the steps are as follows:</p><ol><li>Take the Anki service as an example, which listens on port 27701. Create a configuration file:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /etc/nginx/conf.d <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>vim /etc/nginx/conf.d/anki.conf
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>Write the following configuration. The port number range is 0-65535. Here I will only listen to high ports like 63001 and only use SSL access. HTTP will not be set to listen.</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>63001</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:63001</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>anki.example.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:27701</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-Proto</span> <span class=nv>$scheme</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_redirect</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-Port</span> <span class=nv>$remote_port</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>HTTP_X_FORWARDED_FOR</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-NginX-Proxy</span> <span class=s>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Accept-Encoding</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span> <span class=s>/root/.acme.sh/example.com_ecc/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span> <span class=s>/root/.acme.sh/example.com_ecc/example.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>add_header</span> <span class=s>Strict-Transport-Security</span> <span class=s>&#34;max-age=63072000&#34;</span> <span class=s>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Doing so may cause some devices to fail to redirect from HTTP to HTTPS. You need to manually enter <code>https://</code> before the domain name.</p><p>In addition, you need to remember to open port 63001 in the firewall.</p></blockquote><h2 id=2-install-and-configure-ddns-go>2 Install and Configure DDNS-GO<a hidden class=anchor aria-hidden=true href=#2-install-and-configure-ddns-go>#</a></h2><p>I use the <a href=https://github.com/jeessy2/ddns-go>ddns-go</a> project for setup. The Docker command is as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --name ddns-go <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --restart<span class=o>=</span>always <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --net<span class=o>=</span>host <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /home/wang/docker_data/ddns-go:/root <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  jeessy2/ddns-go
</span></span></code></pre></td></tr></table></div></div><p>After the container is built, you can directly access the web interface of ddns-go at port 9876 and make the following configurations:</p><ol><li>Select Cloudflare as the DNS provider.</li><li>Open the <a href=https://dash.cloudflare.com>Cloudflare homepage</a>, find &ldquo;Manage Account&rdquo; > &ldquo;Account API Tokens&rdquo; > &ldquo;Create Token&rdquo; > &ldquo;Edit Zone DNS&rdquo;, click &ldquo;Use Template&rdquo;, and then select your own secondary domain as the zone to include.</li><li>Copy the generated Token value and paste it into the DDNS-GO web interface.</li><li>Continue in the web interface, check to enable IPv6, select &ldquo;Get through network interface&rdquo;, select the corresponding network interface, fill in the third-level domain name that you need to dynamically resolve at Domains, and then save the above configuration.</li><li>Try to query your third-level domain IP from the command line:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nslookup xxx.example.com
</span></span></code></pre></td></tr></table></div></div><h2 id=3-about-the-risks-of-ddns>3 About the Risks of DDNS<a hidden class=anchor aria-hidden=true href=#3-about-the-risks-of-ddns>#</a></h2><p>Since DDNS requires domain name configuration and DNS resolution needs to be configured with the domain name provider, in principle, website establishment must be filed with the Ministry of Industry and Information Technology.</p><p>However, home equipment cannot be used for filing. In addition, according to online information, operators sometimes detect and block TLS inbound traffic. Therefore, using DDNS may face certain risks.</p><p>There are several ways to avoid this risk:</p><ol><li>Use high ports. Try not to use commonly used ports such as 80, 443, 8080, and 8443 (these ports are closed by default in some areas).</li><li>Add an access path to the domain name. For example, <code>xxx.example.com</code> can be changed to only be accessible through <code>xxx.example.com/path</code>, and if no path is entered, a 444 error is returned.</li><li>Give up public network access and use VPN instead. Using VPN access is undoubtedly the safest, but this method is generally limited to personal use, and sharing it with others will be more troublesome. The Tailscale section below will introduce this practice.</li><li>Manual DDNS. Configure an SMTP mail server to periodically send the current IPv6 of the server to the mailbox. This is the most brutal approach and can be used as a backup. The following will introduce this practice.</li></ol><h1 id=using-tailscale-vpn>Using Tailscale VPN<a hidden class=anchor aria-hidden=true href=#using-tailscale-vpn>#</a></h1><p><a href=https://tailscale.com/>Tailscale</a> is a virtual private network construction tool based on the WireGuard protocol, which can connect devices in different locations to a private network.</p><p>The biggest advantage of Tailscale is that if both devices have public IPv6, they can connect directly without the need for a third-party server to relay, so the access speed can be guaranteed.</p><p>The installation of Tailscale is basically not difficult. Just download it normally from the <a href=https://tailscale.com/download/windows>Download</a> page and complete the installation and registration process.</p><p>After installing Tailscale on all devices, you can query all online and offline devices in the virtual private network on the <a href=https://login.tailscale.com/admin/machines>Admin console</a> page. From then on, as long as we keep Tailscale running in the background, we can use the local area network domain name or IP to directly access the corresponding service.</p><p>Linux systems can use the following commands to query and turn off/on Tailscale:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> tailscaled
</span></span><span class=line><span class=cl>sudo systemctl status tailscaled
</span></span><span class=line><span class=cl>sudo systemctl restart tailscaled
</span></span><span class=line><span class=cl>sudo systemctl stop tailscaled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat /lib/systemd/system/tailscaled.service
</span></span></code></pre></td></tr></table></div></div><p>Tailscale has many other uses. For me, currently I only need to achieve the purpose of VPN access. I will continue to update it later if needed.</p><h2 id=1-relay-server>1 Relay Server<a hidden class=anchor aria-hidden=true href=#1-relay-server>#</a></h2><p>For devices without IPv6, Tailscale supports using a relay server. However, the relay servers provided by Tailscale are all abroad, and the delay is difficult to guarantee. We can use the following command to query the official relay server latency:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Test relay server latency</span>
</span></span><span class=line><span class=cl>tailscale netcheck
</span></span><span class=line><span class=cl><span class=c1># Output as follows</span>
</span></span><span class=line><span class=cl>Report:
</span></span><span class=line><span class=cl>        * Time: 2025-01-26T10:37:16.276723386Z
</span></span><span class=line><span class=cl>        * UDP: <span class=nb>true</span>
</span></span><span class=line><span class=cl>        * IPv4: yes, xxx.xxx.xxx.xxx:26667
</span></span><span class=line><span class=cl>        * IPv6: yes, <span class=o>[</span>240e:xxxx:xxxx:xxxx::c2<span class=o>]</span>:57110
</span></span><span class=line><span class=cl>        * MappingVariesByDestIP: <span class=nb>false</span>
</span></span><span class=line><span class=cl>        * PortMapping:
</span></span><span class=line><span class=cl>        * CaptivePortal: <span class=nb>false</span>
</span></span><span class=line><span class=cl>        * Nearest DERP: Tokyo
</span></span><span class=line><span class=cl>        * DERP latency:
</span></span><span class=line><span class=cl>                - tok: 130.7ms <span class=o>(</span>Tokyo<span class=o>)</span>
</span></span><span class=line><span class=cl>                - sin: 159ms   <span class=o>(</span>Singapore<span class=o>)</span>
</span></span><span class=line><span class=cl>                - sfo: 160.1ms <span class=o>(</span>San Francisco<span class=o>)</span>
</span></span><span class=line><span class=cl>                - hkg: 166.8ms <span class=o>(</span>Hong Kong<span class=o>)</span>
</span></span><span class=line><span class=cl>                - lax: 167.9ms <span class=o>(</span>Los Angeles<span class=o>)</span>
</span></span><span class=line><span class=cl>                - sea: 168.2ms <span class=o>(</span>Seattle<span class=o>)</span>
</span></span><span class=line><span class=cl>                - den: 172.6ms <span class=o>(</span>Denver<span class=o>)</span>
</span></span><span class=line><span class=cl>                - ... ...
</span></span></code></pre></td></tr></table></div></div><p>In order to improve the user experience of devices without public IPv6, we can also build a relay server. But for my current situation, there is no need for this at all, so I have not tried it.</p><h2 id=2-file-sharing>2 File Sharing<a hidden class=anchor aria-hidden=true href=#2-file-sharing>#</a></h2><p>Tailscale only needs to turn on the &ldquo;Send Files&rdquo; function in the <a href=https://login.tailscale.com/admin/settings/general>General interface</a> to transfer files between online devices in the virtual private network.</p><p>Windows and Android systems will send to the system&rsquo;s <code>Downloads</code> folder, and Linux systems will send to the following directory:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/var/lib/tailscale/files/Account Email-uid-xxxxxx
</span></span></code></pre></td></tr></table></div></div><p>However, I currently feel that this function is still a bit tasteless. Android still needs to specifically turn on Tailscale to transfer files each time. Although Windows and Linux can be set to start automatically by default, various shared folders can be mounted in advance.</p><h1 id=regularly-send-ipv6-address-by-email>Regularly Send IPv6 Address by Email<a hidden class=anchor aria-hidden=true href=#regularly-send-ipv6-address-by-email>#</a></h1><p>In order to prevent the DDNS method from failing, I also prepared a most brutal method, which is to write a simple script in Python to regularly use my Foxmail mailbox to report the current IPv6 address of the server to my Outlook mailbox, so that in special circumstances, pure IP access can be used.</p><p>The specific steps are as follows:</p><ol><li>First, configure the <a href="https://wx.mail.qq.com/list/readtemplate?name=app_intro.html#/agreement/authorizationCode">SMTP/IMAP service</a> in Foxmail, just follow the instructions on the official website.</li><li>Execute the following command to create a Conda environment and install related modules:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>conda create -n ddns <span class=nv>python</span><span class=o>=</span>3.11 <span class=o>&amp;&amp;</span> conda activate ddns
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pip install requests schedule
</span></span></code></pre></td></tr></table></div></div><p>I wrote a simple Python script here:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /home/wang/shell/ddns_mail.py
</span></span></code></pre></td></tr></table></div></div><p>Write the following content:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>smtplib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>email.mime.text</span> <span class=kn>import</span> <span class=n>MIMEText</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>schedule</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Email configuration</span>
</span></span><span class=line><span class=cl><span class=n>SMTP_SERVER</span> <span class=o>=</span> <span class=s1>&#39;smtp.qq.com&#39;</span>  <span class=c1># SMTP server address</span>
</span></span><span class=line><span class=cl><span class=n>SMTP_PORT</span> <span class=o>=</span> <span class=mi>587</span>  <span class=c1># SMTP server port number</span>
</span></span><span class=line><span class=cl><span class=n>EMAIL_ADDRESS</span> <span class=o>=</span> <span class=s1>&#39;xxx@foxmail.com&#39;</span> <span class=c1># Sending email address</span>
</span></span><span class=line><span class=cl><span class=n>EMAIL_PASSWORD</span> <span class=o>=</span> <span class=s2>&#34;xxx&#34;</span> <span class=c1># Email application specific password</span>
</span></span><span class=line><span class=cl><span class=n>RECEIVER_EMAIL</span> <span class=o>=</span> <span class=s1>&#39;xxx@outlook.com&#39;</span> <span class=c1># Recipient email address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># API for obtaining IPv6 address (can be changed as needed, or obtained directly from local)</span>
</span></span><span class=line><span class=cl><span class=n>IPV6_API</span> <span class=o>=</span> <span class=s1>&#39;https://api6.ipify.org&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_ipv6_address</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34;Get the IPv6 address of the server.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>IPV6_API</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>  <span class=c1># Check if the request was successful</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Failed to get IPv6 address: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_email</span><span class=p>(</span><span class=n>ipv6_address</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34;Send an email containing the IPv6 address.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=n>ipv6_address</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=n>MIMEText</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;The current IPv6 address of the server is: </span><span class=si>{</span><span class=n>ipv6_address</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>[</span><span class=s1>&#39;Subject&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;Server IPv6 Address&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>[</span><span class=s1>&#39;From&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>EMAIL_ADDRESS</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>[</span><span class=s1>&#39;To&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>RECEIVER_EMAIL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>server</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>server</span> <span class=o>=</span> <span class=n>smtplib</span><span class=o>.</span><span class=n>SMTP</span><span class=p>(</span><span class=n>SMTP_SERVER</span><span class=p>,</span> <span class=n>SMTP_PORT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>server</span><span class=o>.</span><span class=n>starttls</span><span class=p>()</span>  <span class=c1># Enable TLS encryption</span>
</span></span><span class=line><span class=cl>      <span class=n>server</span><span class=o>.</span><span class=n>login</span><span class=p>(</span><span class=n>EMAIL_ADDRESS</span><span class=p>,</span> <span class=n>EMAIL_PASSWORD</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>server</span><span class=o>.</span><span class=n>sendmail</span><span class=p>(</span><span class=n>EMAIL_ADDRESS</span><span class=p>,</span> <span class=n>RECEIVER_EMAIL</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>as_string</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Email sent successfully!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span> <span class=c1># Catch a wider range of exceptions</span>
</span></span><span class=line><span class=cl>      <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Email sending failed: (</span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>) </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=c1># Output the type of exception</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>server</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>               <span class=n>server</span><span class=o>.</span><span class=n>quit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>               <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error closing connection: (</span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>) </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Unable to send email, IPv6 address unknown.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>job</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34;Scheduled task function, get and send IPv6 address.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>ipv6_address</span> <span class=o>=</span> <span class=n>get_ipv6_address</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>send_email</span><span class=p>(</span><span class=n>ipv6_address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set up scheduled tasks</span>
</span></span><span class=line><span class=cl><span class=n>schedule</span><span class=o>.</span><span class=n>every</span><span class=p>()</span><span class=o>.</span><span class=n>day</span><span class=o>.</span><span class=n>at</span><span class=p>(</span><span class=s2>&#34;20:17&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>do</span><span class=p>(</span><span class=n>job</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The script has been started and will send the IPv6 address regularly every day.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>.</span><span class=n>run_pending</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>Add a daemon for the above script:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vim /etc/systemd/system/ddns_mail.service
</span></span></code></pre></td></tr></table></div></div><p>Write the following content:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>DDNS Mail</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>wang</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/home/wang/shell</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/home/wang/apps/miniconda3/envs/ddns/bin/python /home/wang/shell/ddns_mail.py &gt;&gt; /home/wang/logs/ddns_mail.log 2&gt;&amp;1</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>Enable or disable process services.</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl daemon-reload
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> ddns_mail.service
</span></span><span class=line><span class=cl>sudo systemctl restart ddns_mail.service
</span></span><span class=line><span class=cl>sudo systemctl status ddns_mail.service
</span></span><span class=line><span class=cl><span class=c1># Query logs</span>
</span></span><span class=line><span class=cl>journalctl -u ddns_mail.service
</span></span></code></pre></td></tr></table></div></div><blockquote><p>The above script is currently running normally, but the output log is always empty. I have checked manual execution and permission issues, but I still can&rsquo;t solve it. I don&rsquo;t want to delve into the specific reasons for the time being, as long as it can be used normally.</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangzitao21.github.io/en/tags/network/>Network</a></li><li><a href=https://wangzitao21.github.io/en/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=next href=https://wangzitao21.github.io/en/principles-and-access-process-of-the-ssh-protocol/><span class=title>Next »</span><br><span>Principles and Access Process of the SSH Protocol</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=wangzitao21/wangzitao21.github.io data-repo-id=R_kgDONoUNzQ data-category=Announcements data-category-id=DIC_kwDONoUNzc4Cl6-6 data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>